@file:Suppress("FILE_NAME_MATCH_CLASS")

package com.saveourtool.save.frontend.components.views.fossgraph

import com.saveourtool.save.entities.vulnerability.VulnerabilityDto
import com.saveourtool.save.frontend.externals.progressbar.Color
import com.saveourtool.save.frontend.externals.progressbar.progressBar
import js.core.jso
import react.FC
import react.Props
import react.dom.html.ReactHTML.div
import web.cssom.*

private const val FOR_GREEN = 34
private const val FOR_YELLOW = 67
private const val MAX_VALUE = 100

val vulnerabilityBadge: FC<VulnerabilityBadgeProps> = FC { props ->
    div {
        className = ClassName("col")
        div {
            className = ClassName("text-xs text-center font-weight-bold text-primary text-uppercase mb-4")
            +props.vulnerability.name
        }

        val (color, criticalityLabel) = when (props.vulnerability.progress) {
            in 0..FOR_GREEN -> Color.GREEN.hexColor to "Low"
            in FOR_GREEN..FOR_YELLOW -> Color.YELLOW.hexColor to "Moderate"
            in FOR_YELLOW..MAX_VALUE -> Color.RED.hexColor to "Critical"
            else -> throw IllegalStateException("Progress should be in [0; 100], got ${props.vulnerability.progress}")
        }

        div {
            div {
                className = ClassName("row mb-2")
                div {
                    className = ClassName("mx-auto")
                    @Suppress("MAGIC_NUMBER", "MagicNumber")
                    progressBar(props.vulnerability.progress, color = color, size = 150, lineWidth = 45)
                }
            }
            div {
                className = ClassName("text-center font-weight-bold text-uppercase mb-2 mx-auto")
                style = jso {
                    this.color = color.unsafeCast<ColorProperty>()
                }
                +criticalityLabel
            }
        }
    }
}

/**
 * [Props] of [vulnerabilityBadge]
 */
external interface VulnerabilityBadgeProps : Props {
    /**
     * [VulnerabilityDto] to display
     */
    var vulnerability: VulnerabilityDto
}
