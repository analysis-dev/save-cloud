@file:Suppress("HEADER_MISSING_IN_NON_SINGLE_CLASS_FILE")

package com.saveourtool.save.frontend.components.views.fossgraph

import com.saveourtool.save.entities.vulnerability.VulnerabilityDto
import com.saveourtool.save.entities.vulnerability.VulnerabilityProjectDto
import com.saveourtool.save.frontend.components.inputform.InputTypes
import com.saveourtool.save.frontend.utils.*
import csstype.ClassName
import react.VFC
import react.dom.aria.ariaDescribedBy
import react.dom.html.ButtonType
import react.dom.html.ReactHTML.button
import react.dom.html.ReactHTML.div
import react.dom.html.ReactHTML.form
import react.dom.html.ReactHTML.h1
import react.dom.html.ReactHTML.label
import react.dom.html.ReactHTML.span
import react.dom.html.ReactHTML.textarea
import react.useState

val createVulnerabilityView: VFC = VFC {
    useBackground(Style.BLUE)

    val (vulnerability, setVulnerability) = useState(VulnerabilityDto.empty)
    val (vulnerabilityProjects, setVulnerabilityProjects) = useState(mutableListOf<VulnerabilityProjectDto>())

    val projectWindowOpenness = useWindowOpenness()
    val fetchProjectCredentials2: (VulnerabilityProjectDto) -> Unit = { project ->
        vulnerabilityProjects.add(project)
        projectWindowOpenness.closeWindow()
    }

    vulnerabilityProjectWindow {
        windowOpenness = projectWindowOpenness
        fetchProjectCredentials = fetchProjectCredentials2
    }

    div {
        className = ClassName("page-header align-items-start min-vh-100")
        span {
            className = ClassName("mask bg-gradient-dark opacity-6")
        }
        div {
            className = ClassName("row justify-content-center")
            div {
                className = ClassName("col-sm-4 mt-5")
                div {
                    className = ClassName("container card o-hidden border-0 shadow-lg my-2 card-body p-0")
                    div {
                        className = ClassName("p-5 text-center")
                        h1 {
                            className = ClassName("h4 text-gray-900 mb-4")
                            +"Propose a new vulnerability"
                        }
                        form {
                            className = ClassName("needs-validation")
                            div {
                                className = ClassName("row-3")

                                div {
                                    className = ClassName("col-md-12 mt-3 mb-3 pl-2 pr-2 text-left")
                                    label {
                                        className = ClassName("form-label")
                                        +"Description"
                                    }
                                    div {
                                        className = ClassName("input-group needs-validation")
                                        textarea {
                                            className = ClassName("form-control")
                                            onChange = {
                                                // FIXME: need to add method on backend
                                            }
                                            ariaDescribedBy = "${InputTypes.DESCRIPTION.name}Span"
                                            rows = 2
                                            id = InputTypes.DESCRIPTION.name
                                            required = false
                                        }
                                    }
                                }

                                div {
                                    className = ClassName("col-md-12 pl-2 pr-2 mt-3 text-left")

                                    label {
                                        className = ClassName("form-label")
                                        +"Affected projects:"
                                    }
                                }

                                div {
                                    className = ClassName("col-md-12 pl-2 pr-2 mt-3 text-left")

                                    buttonBuilder("+") {
                                        projectWindowOpenness.openWindow()
                                    }
                                }
                            }
                        }

                        button {
                            type = ButtonType.button
                            className = ClassName("btn btn-info mt-4")
                            +"Propose a vulnerability"
                            disabled = true
                            onClick = {
                                // FIXME: need to add method on backend
                            }
                        }
                    }
                }
            }
        }
    }
}
