package com.saveourtool.save.entities.cosv

import com.saveourtool.save.info.UserInfo
import com.saveourtool.save.utils.getRelatedLink

import com.saveourtool.osv4k.RawOsvSchema as RawCosvSchema

import kotlinx.serialization.Serializable

/**
 * @property metadataDto
 * @property cosv
 * @property saveContributors save's user from [com.saveourtool.osv4k.OsvSchema.contributors]
 **/
@Serializable
data class VulnerabilityExt(
    val metadataDto: VulnerabilityMetadataDto,
    val cosv: RawCosvSchema,
    val saveContributors: List<UserInfo>,
) {
    /**
     * @return a vulnerability dto with description
     */
    fun toVulnerabilityDtoWithDescription() = metadataDto.toVulnerabilityDto().copy(
        description = metadataDto.details,
        relatedLink = cosv.getRelatedLink(),
    )

    /**
     * @return contributors + owner (creator)
     */
    fun getAllParticipants() = saveContributors.plus(metadataDto.user)
}
