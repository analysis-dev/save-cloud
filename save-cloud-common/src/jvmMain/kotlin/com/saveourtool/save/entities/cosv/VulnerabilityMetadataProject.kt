package com.saveourtool.save.entities.cosv

import com.saveourtool.save.entities.vulnerability.VulnerabilityProjectDto
import com.saveourtool.save.entities.vulnerability.VulnerabilityProjectType
import com.saveourtool.save.spring.entity.BaseEntityWithDto

import com.fasterxml.jackson.annotation.JsonBackReference

import javax.persistence.*

/**
 * Class with projects of common vulnerabilities.
 *
 * @property name name of project with vulnerability
 * @property url url of project
 * @property versions versions of project
 * @property type type of link
 * @property vulnerabilityMetadata
 **/
@Entity
class VulnerabilityMetadataProject(

    var name: String,

    var url: String,

    var versions: String?,

    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "vulnerability_metadata_id")
    @JsonBackReference
    var vulnerabilityMetadata: VulnerabilityMetadata,

    @Enumerated(EnumType.STRING)
    var type: VulnerabilityProjectType,

) : BaseEntityWithDto<VulnerabilityProjectDto>() {
    /**
     * @return a dto
     */
    override fun toDto() = VulnerabilityProjectDto(
        name = name,
        url = url,
        versions = versions.orEmpty(),
        type = type,
        vulnerabilityIdentifier = vulnerabilityMetadata.identifier,
    )
}
