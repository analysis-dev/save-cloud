package com.saveourtool.save.entities.vulnerabilities

import com.saveourtool.save.entities.vulnerability.VulnerabilityDateDto
import com.saveourtool.save.entities.vulnerability.VulnerabilityDateType
import com.saveourtool.save.spring.entity.BaseEntityWithDateAndDto

import com.fasterxml.jackson.annotation.JsonBackReference

import java.time.LocalDateTime
import javax.persistence.*

import kotlinx.datetime.toKotlinLocalDateTime

/**
 * @property date
 * @property type
 * @property vulnerability
 * @property userId
 */
@Entity
class VulnerabilityDate(

    var date: LocalDateTime,

    @Enumerated(EnumType.STRING)
    var type: VulnerabilityDateType,

    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "vulnerability_id")
    @JsonBackReference
    var vulnerability: Vulnerability,

    var userId: Long,

) : BaseEntityWithDateAndDto<VulnerabilityDateDto>() {
    override fun toDto() = VulnerabilityDateDto(
        date = date.toKotlinLocalDateTime(),
        type = type,
        vulnerabilityName = vulnerability.name,
    )
}
