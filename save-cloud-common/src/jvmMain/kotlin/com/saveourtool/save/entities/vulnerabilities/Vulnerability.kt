package com.saveourtool.save.entities.vulnerabilities

import com.saveourtool.save.entities.vulnerability.VulnerabilityDto
import com.saveourtool.save.spring.entity.BaseEntityWithDto

import com.fasterxml.jackson.annotation.JsonIgnore

import javax.persistence.*

/**
 * @property name of vulnerability
 * @property progress critical of vulnerability
 * @property description vulnerability
 * @property projects link to vulnerability
 **/
@Entity
class Vulnerability(

    var name: String,

    var progress: Int,

    @OneToOne
    @JoinColumn(name = "description_id")
    var description: VulnerabilityDescription?,

    @OneToMany(
        fetch = FetchType.EAGER,
        mappedBy = "vulnerability",
        targetEntity = VulnerabilityProject::class,
    )
    @JsonIgnore
    var projects: List<VulnerabilityProject>,

) : BaseEntityWithDto<VulnerabilityDto>() {
    /**
     * @return a vulnerability dto
     */
    override fun toDto() = VulnerabilityDto(
        name = name,
        progress = progress,
        description = description?.description,
        projects = projects.map { it.toDto() }
    )
}
