package com.saveourtool.save.entities.vulnerabilities

import com.saveourtool.save.entities.vulnerability.VulnerabilityDto
import com.saveourtool.save.spring.entity.BaseEntityWithDto

import com.fasterxml.jackson.annotation.JsonIgnore
import java.time.LocalDateTime

import javax.persistence.*

/**
 * @property name name of vulnerability
 * @property progress vulnerability criticality percentage (1..100)
 * @property projects links to projects with this vulnerability
 * @property isActive admin vulnerability check flag
 * @property createDate create date of vulnerability
 * @property updateDate update date of vulnerability
 **/
@Entity
class Vulnerability(

    var name: String,

    var progress: Int,

    @OneToMany(
        fetch = FetchType.EAGER,
        cascade = [CascadeType.ALL],
        mappedBy = "vulnerability",
        targetEntity = VulnerabilityProject::class,
    )
    @JsonIgnore
    var projects: List<VulnerabilityProject>,

    var isActive: Boolean,

    var createDate: LocalDateTime,

    var updateDate: LocalDateTime,

) : BaseEntityWithDto<VulnerabilityDto>() {
    /**
     * @return a vulnerability dto
     */
    override fun toDto() = VulnerabilityDto(
        name = name,
        progress = progress,
        projects = projects.map { it.toDto() },
        description = null,
        isActive = isActive
    )

    /**
     * @param description of vulnerability
     * @return a vulnerability dto with description
     */
    fun toDtoWithDescription(description: String?) = VulnerabilityDto(
        name = name,
        progress = progress,
        projects = projects.map { it.toDto() },
        description = description,
        isActive = isActive
    )
}
