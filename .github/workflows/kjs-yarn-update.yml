name: Update yarn.lock generated by Kotlin Gradle Plugin

on:
  push:
    branches:
      - renovate/**
  pull_request:
    types:
      - opened
      - reopened
      
jobs:
  run_if:
    if:  startsWith(github.head_ref, 'renovate/')
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Generate yarn.lock
        run: ./gradlew kotlinStoreYarnLock
      - name: Commit and push if yarn.lock is changed
        run: |
          git add yarn.lock
          if git diff --staged --quiet; then
            echo Everything is UP-TO-DATE
          else
            echo Pushing updated yarn.lock
            git config user.name github-actions
            git config user.email github-actions@github.com
            git commit -m "Update yarn.lock"
            git push
          fi
